# Understanding RxJS

RxJS 是一个针对事件的库。

>RxJS是一个通过使用可观察序列来构建异步和基于事件的程序的库。它提供了一个核心类型:Observable、卫星类型(大概是这些类型均围绕于Observable，也就是Observable是根基，而这些是辅助类型):Observer、Schedulers、Subjects)和操作符-衍生自一些数组方法，使得我们可以把异步事件以集合的方式进行处理。

## RxJS 基本概念

* Observable: 可观察对象，是一个可被调用的未来值或事件的集合
* Observer: 观察者， callback函数，知道如何监听被Observable发送的值
* Subscription: 订阅, 表示一个可观察对象的执行，主要用于取消执行
* Operators: 操作符，以函数式编程的方式处理集合 比如 map,filter,contact, flatmap
* Subject：主题，等同于一个事件驱动器，是将一个值或事件广播到多个观察者的唯一途径
* Schedulers: 调度者，用来控制并发，当计算发生时允许我们协调，如setTimeout， requestAnimationFrame

## 示例1

通常这样注册事件监听
```javascript
var button = document.querySelector('button');
button.addEventListener('click',() => console.log('clicked'));
```
使用RxJS 创建一个可观察对象
```javascript
var button = document.querySelector('button');
Rx.Observable.fromEvent(button,'click')
    .subscribe(() => console.log('clicked'));
```

## Purity 纯函数

RxJX 能够使用纯函数的方式提升产值，减少错误提升

一个非纯函数如下：
```javascript
var count = 0;
var button = document.querySelector('button');
button.addEventListener('click',() => console.log(`Clicked ${++count} times`));
```
使用RxJS来隔离你的状态
```javascript
var button = document.querySelector('button');
Rx.Observale.fromEvent(button,'click')
    .scan(count =>count + 1 ,0)
    .subscribe(count => console.log(`Clicked ${count} times`));
```
scan operator 和数组中reduce类似，将0传递给回调函数count => count + 1;回调函数的返回值成为下一次回调函数运行时要传递的参数值

## Flow流

RxJS 有很多operator，可以控制事件流入可观察对象observables.

用纯JavaScript实现 “每秒最多只能点击一次”
```javascript
var count = 0;
var rate = 1000;
var lastClick = Date.now() - rate;
var button = document.querySelector('button');
button.addEventLister('click', () =>{
    if(Date.now() - lastClick >= rate){
        console.log(`Clicked ${++count} times`);
        lastClick = Date.now();
    }
});
```
使用RxJS 
```javascript
var button = document.querySelector('button');
Rx.Observable.fromEvent(button,'click')
    .throttleTime(1000)
    .scan(count => count + 1,0)
    .subscribe(count => console.log(`Clicked ${count} times`));
```
其他的流操作符如filter，delay,debounceTime, take,takeUntil, distinct, distinctUntilChanged等等

## Values 值

纯JS实现获取每次点击鼠标时X坐标位置
```javascript
var count = 0;
var rate = 1000;
var lastClick = Date.now() - rate;
var button = document.querySelector('button');
button.addEventListener('click',(event) =>{
    if(Date.now() - lastClick >= rate){
        console.log(++count + event.clientX)
        lastClick = Date.now();
    }
})
```

用RxJS实现如下
```javascript
var button = document.querySelector('button');
Rx.Observable.fromEvent(button,'click')
    .throttleTime(1000)
    .map(event => event.clientX)
    .scan( (value,clientX)  => value + clientX ,  0 )
    .subscribe( value => console.log(`Clicked ${value} times`));
```

> 不太理解此处？？？存疑

其他的生产者还有pluck, pairwise, sample 等等

下面来一一探索每个概念
[参考](https://buctwbzs.gitbooks.io/rxjs/content/observable.html)